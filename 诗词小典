#include<stdio.h>

#include<string.h>

#include<ctype.h>

#include<stdlib.h>

#include<time.h>

#define N 1000

void printf_1234_0();

void printf_1234_1();

void printf_1234_2();

void printf_1234_3();

void printf_1234_4();

void printf_shouye();

void qingping();

void chaxun();

void chakan();

void jiance();

void tianjia();

void zhiling();

FILE  *in,*out;

char *a[N][2];

int i,j,k,n;

char *mouju,*buchong,c;

int main()

{

	int x;
	
	if ((in=fopen("mingju.txt","a+"))==NULL)

	{

	    printf("Can't open ming.txt");

	    return -1;

	}

	for (i=0;i<N;i++){

	  a[i][0]=(char*)malloc(20*sizeof(char));

          a[i][1]=(char*)malloc(20*sizeof(char));

	}

	mouju=(char*)malloc(20*sizeof(char));

	while (1){

	    if (fscanf(in,"%s",a[n][0])==-1)

	        break;

	    if (fscanf(in,"%s",a[n][1])==-1)

	        break;

	    n++;

	}

	qingping();

	printf_shouye();
  
        while ((c=getchar())!='\n');

	while (1){

	    qingping();
	    
            printf_1234_0();

            zhiling();

	}

	//printf("%d", n); 

        fclose(in);

	return 0;

}

void printf_1234_0()

{

	printf("查找请输入1\n");

	printf("查看请输入2\n");

	printf("检测请输入3\n");

	printf("添加请输入4\n");

}

void printf_1234_1()

{

	printf("\n\n\n");

	printf("继续查找请输入1\n");

	printf("前往查看请输入2\n");

	printf("前往检测请输入3\n");

	printf("前往添加请输入4\n");

	printf("回车返回菜单\n");

}

void printf_1234_2()

{

	printf("\n\n\n");

	printf("前往查找请输入1\n");

	printf("继续查看请输入2\n");

	printf("前往检测请输入3\n");

	printf("前往添加请输入4\n");

	printf("回车返回菜单\n");

}

void printf_1234_3()

{

	printf("\n\n\n");

	printf("前往查找请输入1\n");

	printf("前往查看请输入2\n");

	printf("继续检测请输入3\n");

	printf("前往添加请输入4\n");

	printf("回车返回菜单\n");

}

void printf_1234_4()

{

	printf("\n\n\n");

	printf("前往查找请输入1\n");

	printf("前往查看请输入2\n");

	printf("前往检测请输入3\n");

	printf("继续添加请输入4\n");

	printf("回车返回菜单\n");

}

void printf_shouye()

{

	printf("欢迎使用诗词名句小典\n");	
	
	printf("本案实现以下功能\n\n");

	printf("1 查询某句的全句\n");

	printf("  如输入 “明日复明日” 或 “明日何其多” ，均输出\n  明日复明日  明日何其多\n  如输入 “明日” ，则输出\n  明日复明日  明日何其多\n  今朝有酒今朝醉  明日愁来明日愁\n");

	printf("2 查看随机的名句\n");

	printf("  随机看看都有哪些大家喜欢的名句\n");

	printf("3 检测了解的名句\n");

	printf("  随机给出某句，看自己能否写出全句\n");

	printf("4 添加缺少的名句\n");

        printf("  本典有限，不断添加完善\n\n");

	printf("回车开始\n");

}

void qingping()

{

	system("clear");

}

void zhiling()

{

	while (1){

    	c=getchar();

    	if (c=='\n') break;

        switch(c){

        case '1':chaxun();break;

        case '2':chakan();break;

        case '3':jiance();break;

        case '4':tianjia();break;

        default:break;

        }

    }

}

void chaxun()

{

	qingping();

        printf("请输入所要查询\n");

	int l=0;

	scanf("%s",mouju);

	for (i=0;i<n;i++){

		if (strstr(a[i][0],mouju)!=NULL

		    ||strstr(a[i][1],mouju)!=NULL){

		    l=1;

		    printf("%s %s\n",a[i][0],a[i][1]);

               }

	}

	if (l==0){

            printf("\n\n\n");

            printf("未找到所要查询，可能是因为\n");

            printf("1 本典内容有限，未能包含\n");

            printf("2 输入有错别字，查询失败\n");

            printf("3 该句太过常见，不必查询\n");

        }

	printf_1234_1();

	zhiling();

}

void chakan()

{

	qingping();

	int a0,a1;

    srand(time(NULL));

    a0=rand()%n;

    printf("%s  %s\n",a[a0][0],a[a0][1]);

    printf_1234_2();

    zhiling();

}

void jiance()

{

	qingping();	int a0,a1;

	int i,l=0;

	char *shangju,*xiaju;

shangju=(char*)malloc(20*sizeof(char));

xiaju=(char*)malloc(20*sizeof(char));

    srand(time(NULL));

    a0=rand()%n;

    a1=rand()%2;

    printf("%s\n",a[a0][a1]);

printf("请写出此句的全句，上下句间以空格隔开\n");

    while (!l){

        scanf("%s",shangju);

        if (!strcmp(shangju,"6")){

            for (i=0;i<n;i++)

		        if (!strcmp(a[i][0],a[a0][a1])

		            ||!strcmp(a[i][1],a[a0][a1]))

		            printf("%s  %s\n",a[i][0],a[i][1]);

		            l=1;

		            break;

                }

        scanf("%s",xiaju);

        if (!strcmp(a[a0][a1],shangju)

            ||!strcmp(a[a0][a1],xiaju))

            for (i=0;i<n;i++){

                if (!strcmp(a[i][0],shangju)

        	        &&!strcmp(a[i][1],xiaju)){

            	    printf("正确\n");

                	l=1;

            	    break;

                }

           }

        if (l==0){

           printf("错误\n");

           printf("可继续作答，如要查看正确"
                      "答案及返回请输入6\n");
        }
    }
    printf_1234_3();
    zhiling();
}
void tianjia()
{
	qingping();
printf("请输入所要补充，上下句之间以空格隔开：\n");
    scanf("%s%s",a[n][0],a[n][1]);
    fprintf(in,"%s %s",a[n][0],a[n][1]);
    n++;
    printf("添加成功\n");
    printf_1234_4();
    zhiling();
}

         
